#!/bin/bash

# 项目初始化系统启动脚本（Mac/Linux）
# 自动使用虚拟环境，无需手动激活

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
VENV_DIR="$SCRIPT_DIR/.venv"
VENV_PYTHON="$VENV_DIR/bin/python"
START_PY="$SCRIPT_DIR/start.py"

# 检查虚拟环境是否存在
if [ ! -d "$VENV_DIR" ]; then
    echo "❌ 错误：虚拟环境不存在"
    echo ""
    echo "请先运行安装脚本创建虚拟环境："
    echo "  python install.py"
    echo "  或"
    echo "  ./install.sh"
    exit 1
fi

# 检查虚拟环境中的Python是否存在
if [ ! -f "$VENV_PYTHON" ]; then
    echo "❌ 错误：虚拟环境中的Python不存在: $VENV_PYTHON"
    echo ""
    echo "请重新运行安装脚本："
    echo "  python install.py"
    exit 1
fi

# 检查start.py是否存在
if [ ! -f "$START_PY" ]; then
    echo "❌ 错误：找不到 start.py: $START_PY"
    exit 1
fi

# 使用虚拟环境的Python运行start.py，并传递所有参数
exec "$VENV_PYTHON" "$START_PY" "$@"

