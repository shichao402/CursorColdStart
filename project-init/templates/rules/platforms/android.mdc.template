---
alwaysApply: true
---
# Android平台特定规则

## 调试规则

### 日志收集优先级

1. **第一优先级：** 应用统一日志服务（`.cursor/rules/01-logging.mdc`）
2. **第二优先级：** adb logcat（系统日志）
3. **第三优先级：** 其他调试工具

### 日志收集方式

**必须使用 adb logcat 收集系统日志：**

```bash
# 收集所有日志
adb logcat > logs/android_system.log

# 收集特定tag的日志
adb logcat -s YourAppTag:D *:S

# 清空日志缓冲区后收集
adb logcat -c && adb logcat > logs/android_system.log
```

## 截图和屏幕录制

### 禁止行为

- ❌ **严格禁止要求用户提供截图**
- ❌ **禁止要求用户手动截图**
- ❌ **禁止要求用户使用其他工具截图**

### 必须遵守

- ✅ **必须使用 adb 命令自动截图**
- ✅ **必须使用 adb 命令自动录制屏幕**
- ✅ **AI必须主动执行截图/录制命令，不要求用户操作**

### adb截图命令

```bash
# 截图
adb shell screencap -p /sdcard/screenshot.png
adb pull /sdcard/screenshot.png screenshots/
adb shell rm /sdcard/screenshot.png

# 或使用一行命令
adb exec-out screencap -p > screenshots/screenshot_$(date +%Y%m%d_%H%M%S).png
```

### adb屏幕录制命令

```bash
# 开始录制（后台运行）
adb shell screenrecord /sdcard/record.mp4 &

# 停止录制（Ctrl+C后）
adb pull /sdcard/record.mp4 recordings/
adb shell rm /sdcard/record.mp4
```

## 调试流程

### 标准调试流程

1. **收集应用日志**
   ```bash
   # 使用统一日志收集脚本
   ./scripts/collect_all_logs.sh
   ```

2. **收集系统日志**
   ```bash
   # 使用adb logcat
   adb logcat -d > logs/android_system.log
   ```

3. **自动截图（如需要）**
   ```bash
   # AI自动执行，不要求用户操作
   adb exec-out screencap -p > screenshots/debug_$(date +%Y%m%d_%H%M%S).png
   ```

4. **分析日志和截图**
   - AI分析收集的日志
   - AI分析截图（如果已自动获取）
   - 提供解决方案

## 应用安装和卸载

### 安装应用

```bash
# 安装APK
adb install -r path/to/app.apk

# 安装并启动
adb install -r path/to/app.apk && adb shell am start -n com.example.app/.MainActivity
```

### 卸载应用

```bash
# 卸载应用
adb uninstall com.example.app
```

## 设备管理

### 检查设备连接

```bash
# 列出连接的设备
adb devices

# 如果多个设备，指定设备
adb -s DEVICE_ID command
```

### 查看应用信息

```bash
# 查看已安装的应用
adb shell pm list packages | grep com.example.app

# 查看应用详细信息
adb shell dumpsys package com.example.app
```

## 性能监控

### CPU和内存使用

```bash
# 查看应用CPU和内存使用
adb shell top -n 1 | grep com.example.app

# 持续监控
adb shell top -d 1 | grep com.example.app
```

## 文件操作

### 推送文件到设备

```bash
# 推送文件
adb push local_file.txt /sdcard/

# 推送目录
adb push local_dir/ /sdcard/
```

### 从设备拉取文件

```bash
# 拉取文件
adb pull /sdcard/file.txt ./

# 拉取目录
adb pull /sdcard/dir/ ./
```

## 注意事项

1. **始终先检查设备连接** - 执行adb命令前检查设备是否连接
2. **自动执行** - AI必须主动执行adb命令，不要求用户操作
3. **错误处理** - 如果adb命令失败，提供清晰的错误信息和解决方案
4. **多设备支持** - 如果连接多个设备，必须指定设备ID

